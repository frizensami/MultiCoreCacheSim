<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |This module defines methods for interacting with and creating processors</span><span>
</span><a name="line-2"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Processor</span><span> </span><span>
</span><a name="line-3"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="Processor.html#createProcessor"><span class="hs-identifier hs-var">createProcessor</span></a><span>
</span><a name="line-4"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Processor.html#runOneCycle"><span class="hs-identifier hs-var">runOneCycle</span></a><span>
</span><a name="line-5"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Processor.html#ProcessorStatus"><span class="hs-identifier hs-type">ProcessorStatus</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-6"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-8"></a><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><a href="Definitions.html"><span class="hs-identifier">Definitions</span></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Trace.html"><span class="hs-identifier">Trace</span></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><a href="Bus.html"><span class="hs-identifier">Bus</span></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><a href="Statistics.html"><span class="hs-identifier">Statistics</span></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Debug</span><span class="hs-operator">.</span><span class="hs-identifier">Trace</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Cache.html"><span class="hs-identifier">Cache</span></a><span> </span><span class="hs-special">(</span><a href="Cache.html#Cache"><span class="hs-identifier hs-type">Cache</span></a><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Cache.html"><span class="hs-identifier">Cache</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Cache</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">type</span><span> </span><a name="HasConsumedTrace"><a href="Processor.html#HasConsumedTrace"><span class="hs-identifier">HasConsumedTrace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-18"></a><span>
</span><a name="line-19"></a><span class="hs-keyword">data</span><span> </span><a name="ProcessorStatus"><a href="Processor.html#ProcessorStatus"><span class="hs-identifier">ProcessorStatus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Idle"><a href="Processor.html#Idle"><span class="hs-identifier">Idle</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Blocked"><a href="Processor.html#Blocked"><span class="hs-identifier">Blocked</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Running"><a href="Processor.html#Running"><span class="hs-identifier">Running</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span class="hs-keyword">data</span><span> </span><a name="Processor"><a href="Processor.html#Processor"><span class="hs-identifier">Processor</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Processor"><a href="Processor.html#Processor"><span class="hs-identifier">Processor</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getProcessorID"><a href="Processor.html#getProcessorID"><span class="hs-identifier">getProcessorID</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-21"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="getProcessorStatus"><a href="Processor.html#getProcessorStatus"><span class="hs-identifier">getProcessorStatus</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Processor.html#ProcessorStatus"><span class="hs-identifier hs-type">ProcessorStatus</span></a><span>
</span><a name="line-22"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="getCache"><a href="Processor.html#getCache"><span class="hs-identifier">getCache</span></a></a><span>               </span><span class="hs-glyph">::</span><span> </span><a href="Cache.html#Cache"><span class="hs-identifier hs-type">Cache</span></a><span>
</span><a name="line-23"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="getProcessorStatistics"><a href="Processor.html#getProcessorStatistics"><span class="hs-identifier">getProcessorStatistics</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Statistics.html#ProcessorStatistics"><span class="hs-identifier hs-type">ProcessorStatistics</span></a><span>
</span><a name="line-24"></a><span>                           </span><span class="hs-special">,</span><span> </span><a name="getCyclesToCompute"><a href="Processor.html#getCyclesToCompute"><span class="hs-identifier">getCyclesToCompute</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-25"></a><span>                           </span><span class="hs-special">}</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-28"></a><span>    </span><a name="local-8214565720323790720"><span class="hs-identifier">show</span></a><span> </span><span class="hs-special">(</span><a href="Processor.html#Processor"><span class="hs-identifier hs-var">Processor</span></a><span> </span><a name="local-6989586621679047988"><a href="#local-6989586621679047988"><span class="hs-identifier">pid</span></a></a><span> </span><a name="local-6989586621679047989"><a href="#local-6989586621679047989"><span class="hs-identifier">status</span></a></a><span> </span><a name="local-6989586621679047990"><a href="#local-6989586621679047990"><span class="hs-identifier">cache</span></a></a><span> </span><a name="local-6989586621679047991"><a href="#local-6989586621679047991"><span class="hs-identifier">stats</span></a></a><span> </span><a name="local-6989586621679047992"><a href="#local-6989586621679047992"><span class="hs-identifier">cycles</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Processor #&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679047988"><span class="hs-identifier hs-var">pid</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: Status - &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679047989"><span class="hs-identifier hs-var">status</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-comment">{- &quot;, Cache - &quot; ++ (show cache) ++ -}</span><span> </span><span class="hs-string">&quot;, Stats: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679047991"><span class="hs-identifier hs-var">stats</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, ComputeCyclesLeft: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679047992"><span class="hs-identifier hs-var">cycles</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-identifier">createProcessor</span><span> </span><span class="hs-glyph">::</span><span>  </span><a href="Definitions.html#ProtocolInput"><span class="hs-identifier hs-type">ProtocolInput</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><a href="Definitions.html#CacheSize"><span class="hs-identifier hs-type">CacheSize</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Definitions.html#Associativity"><span class="hs-identifier hs-type">Associativity</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Definitions.html#BlockSize"><span class="hs-identifier hs-type">BlockSize</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span>
</span><a name="line-31"></a><a name="createProcessor"><a href="Processor.html#createProcessor"><span class="hs-identifier">createProcessor</span></a></a><span> </span><a name="local-6989586621679047940"><a href="#local-6989586621679047940"><span class="hs-identifier">protocolInput</span></a></a><span> </span><a name="local-6989586621679047941"><a href="#local-6989586621679047941"><span class="hs-identifier">cacheSize</span></a></a><span> </span><a name="local-6989586621679047942"><a href="#local-6989586621679047942"><span class="hs-identifier">associativity</span></a></a><span> </span><a name="local-6989586621679047943"><a href="#local-6989586621679047943"><span class="hs-identifier">blockSize</span></a></a><span> </span><a name="local-6989586621679047944"><a href="#local-6989586621679047944"><span class="hs-identifier">pid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-32"></a><span>    </span><a href="Processor.html#Processor"><span class="hs-identifier hs-var">Processor</span></a><span> </span><a href="#local-6989586621679047944"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="Processor.html#Idle"><span class="hs-identifier hs-var">Idle</span></a><span> </span><a href="#local-6989586621679047945"><span class="hs-identifier hs-var">newCache</span></a><span> </span><span class="hs-special">(</span><a href="Statistics.html#newProcessorStatistics"><span class="hs-identifier hs-var">newProcessorStatistics</span></a><span> </span><a href="#local-6989586621679047944"><span class="hs-identifier hs-var">pid</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-33"></a><span>        </span><a name="local-6989586621679047945"><a href="#local-6989586621679047945"><span class="hs-identifier">newCache</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Cache.html#create"><span class="hs-identifier hs-var">Cache</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">create</span></a><span> </span><a href="#local-6989586621679047941"><span class="hs-identifier hs-var">cacheSize</span></a><span> </span><a href="#local-6989586621679047942"><span class="hs-identifier hs-var">associativity</span></a><span> </span><a href="#local-6989586621679047943"><span class="hs-identifier hs-var">blockSize</span></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-comment">-- TO BE IMPLEMENTED - THIS IS FOR TESTING FLOW</span><span>
</span><a name="line-36"></a><span class="hs-identifier">runOneCycle</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Trace.html#Trace"><span class="hs-identifier hs-type">Trace</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bus.html#CacheEventBus"><span class="hs-identifier hs-type">CacheEventBus</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span class="hs-special">,</span><span> </span><a href="Processor.html#HasConsumedTrace"><span class="hs-identifier hs-type">HasConsumedTrace</span></a><span class="hs-special">,</span><span> </span><a href="Bus.html#CacheEventBus"><span class="hs-identifier hs-type">CacheEventBus</span></a><span class="hs-special">)</span><span>
</span><a name="line-37"></a><a name="runOneCycle"><a href="Processor.html#runOneCycle"><span class="hs-identifier">runOneCycle</span></a></a><span> </span><a name="local-6989586621679047946"><a href="#local-6989586621679047946"><span class="hs-identifier">processor</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679047947"><a href="#local-6989586621679047947"><span class="hs-identifier">trace</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679047948"><a href="#local-6989586621679047948"><span class="hs-identifier">eventBus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-38"></a><span>        </span><span class="hs-comment">-- Run print</span><span>
</span><a name="line-39"></a><span>        </span><span class="hs-identifier hs-var">T</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">trace</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679047946"><span class="hs-identifier hs-var">processor</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679047947"><span class="hs-identifier hs-var">trace</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-40"></a><span>        </span><span class="hs-comment">-- First check if we are currently processing anything</span><span>
</span><a name="line-41"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">getCyclesToCompute</span><span> </span><a href="#local-6989586621679047946"><span class="hs-identifier hs-var">processor</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-42"></a><span>            </span><span class="hs-comment">-- If nothing is processing - we continue handling the new trace</span><span>
</span><a name="line-43"></a><span>            </span><span class="hs-keyword">then</span><span> </span><a href="Processor.html#handleTrace"><span class="hs-identifier hs-var">handleTrace</span></a><span> </span><a href="#local-6989586621679047946"><span class="hs-identifier hs-var">processor</span></a><span> </span><a href="#local-6989586621679047947"><span class="hs-identifier hs-var">trace</span></a><span> </span><a href="#local-6989586621679047948"><span class="hs-identifier hs-var">eventBus</span></a><span>
</span><a name="line-44"></a><span>            </span><span class="hs-comment">-- Otherwise, run one cycle from the remaining compute cycles</span><span>
</span><a name="line-45"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047950"><span class="hs-identifier hs-var">newProcessor</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679047951"><span class="hs-identifier hs-var">hasCompleted</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679047948"><span class="hs-identifier hs-var">eventBus</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-46"></a><span>                </span><a name="local-6989586621679047949"><a href="#local-6989586621679047949"><span class="hs-identifier">processResult</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Processor.html#processOneComputeCycle"><span class="hs-identifier hs-var">processOneComputeCycle</span></a><span> </span><a href="#local-6989586621679047946"><span class="hs-identifier hs-var">processor</span></a><span>
</span><a name="line-47"></a><span>                </span><a name="local-6989586621679047950"><a href="#local-6989586621679047950"><span class="hs-identifier">newProcessor</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679047949"><span class="hs-identifier hs-var">processResult</span></a><span>
</span><a name="line-48"></a><span>                </span><a name="local-6989586621679047951"><a href="#local-6989586621679047951"><span class="hs-identifier">hasCompleted</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679047949"><span class="hs-identifier hs-var">processResult</span></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- If we receive no traces, consider self as &quot;done&quot;</span><span>
</span><a name="line-50"></a><span class="hs-identifier">runOneCycle</span><span> </span><a name="local-6989586621679047963"><a href="#local-6989586621679047963"><span class="hs-identifier">processor</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><a name="local-6989586621679047964"><a href="#local-6989586621679047964"><span class="hs-identifier">eventBus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047963"><span class="hs-identifier hs-var">processor</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679047964"><span class="hs-identifier hs-var">eventBus</span></a><span class="hs-special">)</span><span> </span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-comment">-- | Sets up the current trace into the processor and then executes the cycle if it's an OtherInstruction</span><span>
</span><a name="line-54"></a><span class="hs-identifier">handleTrace</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Trace.html#Trace"><span class="hs-identifier hs-type">Trace</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Bus.html#CacheEventBus"><span class="hs-identifier hs-type">CacheEventBus</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span class="hs-special">,</span><span> </span><a href="Processor.html#HasConsumedTrace"><span class="hs-identifier hs-type">HasConsumedTrace</span></a><span class="hs-special">,</span><span> </span><a href="Bus.html#CacheEventBus"><span class="hs-identifier hs-type">CacheEventBus</span></a><span class="hs-special">)</span><span>
</span><a name="line-55"></a><a name="handleTrace"><a href="Processor.html#handleTrace"><span class="hs-identifier">handleTrace</span></a></a><span> </span><span class="hs-special">(</span><a href="Processor.html#Processor"><span class="hs-identifier hs-var">Processor</span></a><span> </span><a name="local-6989586621679047965"><a href="#local-6989586621679047965"><span class="hs-identifier">pid</span></a></a><span> </span><a name="local-6989586621679047966"><a href="#local-6989586621679047966"><span class="hs-identifier">status</span></a></a><span> </span><a name="local-6989586621679047967"><a href="#local-6989586621679047967"><span class="hs-identifier">cache</span></a></a><span> </span><a name="local-6989586621679047968"><a href="#local-6989586621679047968"><span class="hs-identifier">stats</span></a></a><span> </span><a name="local-6989586621679047969"><a href="#local-6989586621679047969"><span class="hs-identifier">cycles</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679047970"><a href="#local-6989586621679047970"><span class="hs-identifier">trace</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Trace.html#OtherInstruction"><span class="hs-identifier hs-var">OtherInstruction</span></a><span> </span><a name="local-6989586621679047971"><a href="#local-6989586621679047971"><span class="hs-identifier">computeCycles</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679047972"><a href="#local-6989586621679047972"><span class="hs-identifier">eventBus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span>
</span><a name="line-56"></a><span>    </span><a href="Processor.html#runOneCycle"><span class="hs-identifier hs-var">runOneCycle</span></a><span> </span><a href="#local-6989586621679047973"><span class="hs-identifier hs-var">newProcessor</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679047970"><span class="hs-identifier hs-var">trace</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679047972"><span class="hs-identifier hs-var">eventBus</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-57"></a><span>        </span><a name="local-6989586621679047973"><a href="#local-6989586621679047973"><span class="hs-identifier">newProcessor</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-var">Processor</span></a><span> </span><a href="#local-6989586621679047965"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679047966"><span class="hs-identifier hs-var">status</span></a><span> </span><a href="#local-6989586621679047967"><span class="hs-identifier hs-var">cache</span></a><span> </span><a href="#local-6989586621679047968"><span class="hs-identifier hs-var">stats</span></a><span> </span><a href="#local-6989586621679047971"><span class="hs-identifier hs-var">computeCycles</span></a><span> </span><span class="hs-comment">-- Set the compute cycles</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- Can't do anything about other instructions yet - do nothing except consume3</span><span>
</span><a name="line-59"></a><span class="hs-identifier">handleTrace</span><span> </span><a name="local-6989586621679047974"><a href="#local-6989586621679047974"><span class="hs-identifier">processor</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679047975"><a href="#local-6989586621679047975"><span class="hs-identifier">eventBus</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047974"><span class="hs-identifier hs-var">processor</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679047975"><span class="hs-identifier hs-var">eventBus</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | Runs one compute cycle from the number of cycles left to do computation</span><span>
</span><a name="line-62"></a><span class="hs-identifier">processOneComputeCycle</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Processor.html#Processor"><span class="hs-identifier hs-type">Processor</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><a name="processOneComputeCycle"><a href="Processor.html#processOneComputeCycle"><span class="hs-identifier">processOneComputeCycle</span></a></a><span> </span><span class="hs-special">(</span><a href="Processor.html#Processor"><span class="hs-identifier hs-var">Processor</span></a><span> </span><a name="local-6989586621679047976"><a href="#local-6989586621679047976"><span class="hs-identifier">pid</span></a></a><span> </span><a name="local-6989586621679047977"><a href="#local-6989586621679047977"><span class="hs-identifier">status</span></a></a><span> </span><a name="local-6989586621679047978"><a href="#local-6989586621679047978"><span class="hs-identifier">cache</span></a></a><span> </span><a name="local-6989586621679047979"><a href="#local-6989586621679047979"><span class="hs-identifier">stats</span></a></a><span> </span><a name="local-6989586621679047980"><a href="#local-6989586621679047980"><span class="hs-identifier">cycles</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047981"><span class="hs-identifier hs-var">newProcessor</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679047982"><span class="hs-identifier hs-var">isDone</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-64"></a><span>    </span><a name="local-6989586621679047981"><a href="#local-6989586621679047981"><span class="hs-identifier">newProcessor</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Processor.html#Processor"><span class="hs-identifier hs-var">Processor</span></a><span> </span><a href="#local-6989586621679047976"><span class="hs-identifier hs-var">pid</span></a><span> </span><a href="#local-6989586621679047977"><span class="hs-identifier hs-var">status</span></a><span> </span><a href="#local-6989586621679047978"><span class="hs-identifier hs-var">cache</span></a><span> </span><span class="hs-special">(</span><a href="Processor.html#addOneStatsComputeCycle"><span class="hs-identifier hs-var">addOneStatsComputeCycle</span></a><span> </span><a href="#local-6989586621679047979"><span class="hs-identifier hs-var">stats</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">max</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047980"><span class="hs-identifier hs-var">cycles</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>    </span><a name="local-6989586621679047982"><a href="#local-6989586621679047982"><span class="hs-identifier">isDone</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getCyclesToCompute</span><span> </span><a href="#local-6989586621679047981"><span class="hs-identifier hs-var">newProcessor</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span class="hs-identifier">addOneStatsComputeCycle</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Statistics.html#ProcessorStatistics"><span class="hs-identifier hs-type">ProcessorStatistics</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Statistics.html#ProcessorStatistics"><span class="hs-identifier hs-type">ProcessorStatistics</span></a><span>
</span><a name="line-68"></a><a name="addOneStatsComputeCycle"><a href="Processor.html#addOneStatsComputeCycle"><span class="hs-identifier">addOneStatsComputeCycle</span></a></a><span> </span><span class="hs-special">(</span><a href="Statistics.html#ProcessorStatistics"><span class="hs-identifier hs-var">ProcessorStatistics</span></a><span> </span><a name="local-6989586621679047983"><a href="#local-6989586621679047983"><span class="hs-identifier">compute</span></a></a><span> </span><a name="local-6989586621679047984"><a href="#local-6989586621679047984"><span class="hs-identifier">loadstore</span></a></a><span> </span><a name="local-6989586621679047985"><a href="#local-6989586621679047985"><span class="hs-identifier">idle</span></a></a><span> </span><a name="local-6989586621679047986"><a href="#local-6989586621679047986"><span class="hs-identifier">misscount</span></a></a><span> </span><a name="local-6989586621679047987"><a href="#local-6989586621679047987"><span class="hs-identifier">pid</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Statistics.html#ProcessorStatistics"><span class="hs-identifier hs-var">ProcessorStatistics</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679047983"><span class="hs-identifier hs-var">compute</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679047984"><span class="hs-identifier hs-var">loadstore</span></a><span> </span><a href="#local-6989586621679047985"><span class="hs-identifier hs-var">idle</span></a><span> </span><a href="#local-6989586621679047986"><span class="hs-identifier hs-var">misscount</span></a><span> </span><a href="#local-6989586621679047987"><span class="hs-identifier hs-var">pid</span></a></pre></body></html>